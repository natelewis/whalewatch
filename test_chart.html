<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Test</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #1f2937;
            color: #d1d5db;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        #chart {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <h1>LLY Chart Test</h1>
    <div id="chart"></div>

    <script>
        // Test data - simulating the sparse data we're getting
        const testData = [
            { time: "2025-09-12T19:00:00.000000Z", open: 755.95, high: 755.95, low: 755.95, close: 755.95 },
            { time: "2025-09-12T19:06:00.000000Z", open: 755.53, high: 755.61, low: 755.53, close: 755.6 },
            { time: "2025-09-12T19:10:00.000000Z", open: 755.795, high: 755.795, low: 755.795, close: 755.795 },
            { time: "2025-09-12T19:12:00.000000Z", open: 755.43, high: 755.43, low: 755.43, close: 755.43 },
            { time: "2025-09-12T19:14:00.000000Z", open: 755.615, high: 755.615, low: 755.615, close: 755.615 },
            { time: "2025-09-12T19:15:00.000000Z", open: 755.72, high: 755.72, low: 755.72, close: 755.72 },
            { time: "2025-09-12T19:20:00.000000Z", open: 755.5, high: 755.5, low: 755.5, close: 755.5 },
            { time: "2025-09-12T19:22:00.000000Z", open: 755.14, high: 755.14, low: 754.93, close: 754.93 },
            { time: "2025-09-12T19:24:00.000000Z", open: 755.085, high: 755.085, low: 754.82, close: 754.82 },
            { time: "2025-09-12T19:25:00.000000Z", open: 755.005, high: 755.005, low: 755.005, close: 755.005 },
            { time: "2025-09-12T19:30:00.000000Z", open: 754.5, high: 754.8, low: 754.2, close: 754.6 },
            { time: "2025-09-12T19:36:00.000000Z", open: 754.8, high: 755.2, low: 754.6, close: 755.0 },
            { time: "2025-09-12T19:40:00.000000Z", open: 755.1, high: 755.3, low: 754.9, close: 755.2 },
            { time: "2025-09-12T19:45:00.000000Z", open: 755.3, high: 755.5, low: 755.1, close: 755.4 },
            { time: "2025-09-12T19:46:00.000000Z", open: 755.815, high: 755.815, low: 755.735, close: 755.735 },
            { time: "2025-09-12T19:48:00.000000Z", open: 755.81, high: 755.91, low: 755.75, close: 755.91 },
            { time: "2025-09-12T19:51:00.000000Z", open: 756.05, high: 756.11, low: 756.04, close: 756.08 },
            { time: "2025-09-12T19:52:00.000000Z", open: 756.46, high: 756.46, low: 756.07, close: 756.07 },
            { time: "2025-09-12T19:54:00.000000Z", open: 756.04, high: 756.095, low: 755.91, close: 755.91 },
            { time: "2025-09-12T19:55:00.000000Z", open: 756.24, high: 756.44, low: 756.115, close: 756.355 },
            { time: "2025-09-12T19:56:00.000000Z", open: 755.6, high: 755.675, low: 755.52, close: 755.52 },
            { time: "2025-09-12T19:57:00.000000Z", open: 755.37, high: 755.37, low: 755.37, close: 755.37 },
            { time: "2025-09-12T19:58:00.000000Z", open: 755.435, high: 755.435, low: 754.7, close: 754.785 },
            { time: "2025-09-12T19:59:00.000000Z", open: 754.79, high: 754.92, low: 754.65, close: 754.92 }
        ];

        // Function to fill missing minutes (similar to our React component)
        function fillMissingMinutes(data) {
            if (data.length === 0) return data;
            
            const filledData = [];
            const intervalMs = 60 * 1000; // 1 minute in milliseconds
            
            for (let i = 0; i < data.length; i++) {
                filledData.push(data[i]);
                
                // Check if there's a gap to the next data point
                if (i < data.length - 1) {
                    const currentTime = new Date(data[i].time).getTime();
                    const nextTime = new Date(data[i + 1].time).getTime();
                    const gapMs = nextTime - currentTime;
                    
                    // If gap is more than 2 minutes, fill with last known price
                    if (gapMs > intervalMs * 2) {
                        const missingMinutes = Math.floor(gapMs / intervalMs) - 1;
                        const lastPrice = data[i].close;
                        
                        for (let j = 1; j <= missingMinutes; j++) {
                            const fillTime = new Date(currentTime + j * intervalMs).toISOString();
                            filledData.push({
                                time: fillTime,
                                open: lastPrice,
                                high: lastPrice,
                                low: lastPrice,
                                close: lastPrice,
                            });
                        }
                    }
                }
            }
            
            return filledData;
        }

        // Fill the data
        const filledData = fillMissingMinutes(testData);
        
        console.log('Original data points:', testData.length);
        console.log('Filled data points:', filledData.length);

        // Create the chart
        const x = filledData.map(d => d.time);
        const open = filledData.map(d => d.open);
        const high = filledData.map(d => d.high);
        const low = filledData.map(d => d.low);
        const close = filledData.map(d => d.close);

        const trace = {
            type: 'candlestick',
            x: x,
            open: open,
            high: high,
            low: low,
            close: close,
            increasing: { 
                line: { color: '#26a69a', width: 1 },
                fillcolor: '#26a69a'
            },
            decreasing: { 
                line: { color: '#ef5350', width: 1 },
                fillcolor: '#ef5350'
            },
            name: 'LLY',
            line: { width: 1 },
            whiskerwidth: 0.8,
            showlegend: false,
        };

        const layout = {
            title: {
                text: 'LLY - 1H (Test)',
                font: { color: '#d1d5db', size: 16 },
            },
            xaxis: {
                type: 'date',
                gridcolor: '#374151',
                color: '#d1d5db',
                title: { text: 'Time', font: { color: '#d1d5db' } },
            },
            yaxis: {
                gridcolor: '#374151',
                color: '#d1d5db',
                title: { text: 'Price', font: { color: '#d1d5db' } },
            },
            plot_bgcolor: 'transparent',
            paper_bgcolor: 'transparent',
            font: { color: '#d1d5db' },
            margin: { l: 50, r: 50, t: 50, b: 50 },
            showlegend: false,
            hovermode: 'x unified',
        };

        Plotly.newPlot('chart', [trace], layout);
    </script>
</body>
</html>
